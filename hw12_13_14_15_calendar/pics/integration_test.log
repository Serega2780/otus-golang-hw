set -e ;\
docker compose -f docker-compose-test.yaml build ;\
test_status_code=0 ;\
docker compose -f docker-compose-test.yaml run integration_tests go test ./integration || test_status_code=$? ;\
docker compose -f docker-compose-test.yaml down ;\
exit $test_status_code ;
#0 building with "default" instance using docker driver

#1 [calendar-sender internal] load build definition from Dockerfile
#1 transferring dockerfile: 876B done
#1 DONE 0.0s

#2 [calendar-sender internal] load .dockerignore
#2 transferring context: 2B done
#2 DONE 0.0s

#3 [calendar-app internal] load build definition from DockerfileTest
#3 transferring dockerfile: 1.03kB done
#3 DONE 0.0s

#4 [calendar-app internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.1s

#5 [calendar-app internal] load metadata for docker.io/library/golang:1.22
#5 DONE 2.4s

#6 [calendar-app internal] load metadata for docker.io/library/alpine:3.9
#6 DONE 2.4s

#7 [calendar-sender stage-1 1/2] FROM docker.io/library/alpine:3.9@sha256:414e0518bb9228d35e4cd5165567fb91d26c6a214e9c95899e1e056fcd349011
#7 DONE 0.0s

#8 [calendar-app build 1/7] FROM docker.io/library/golang:1.22@sha256:4594271250150c1a322ed749abfd218e1a8c6eb1ade90872e325a664412e2037
#8 DONE 0.0s

#9 [calendar-app internal] load build context
#9 transferring context: 276.11kB 0.0s done
#9 DONE 0.0s

#10 [calendar-sender internal] load build context
#10 transferring context: 276.11kB 0.0s done
#10 DONE 0.0s

#11 [calendar-app build 5/9] COPY go.sum .
#11 CACHED

#12 [calendar-app build 3/9] WORKDIR /go/src/
#12 CACHED

#13 [calendar-app build 4/9] COPY go.mod .
#13 CACHED

#14 [calendar-app build 2/9] RUN mkdir -p /opt/calendar/
#14 CACHED

#15 [calendar-app build 6/9] RUN go mod download
#15 CACHED

#16 [calendar-app build 7/9] COPY integration/migrations/ /opt/calendar/
#16 CACHED

#17 [calendar-sender build 2/7] WORKDIR /go/src/
#17 CACHED

#18 [calendar-sender build 4/7] COPY go.sum .
#18 CACHED

#19 [calendar-sender build 3/7] COPY go.mod .
#19 CACHED

#20 [calendar-sender build 5/7] RUN go mod download
#20 CACHED

#21 [calendar-sender build 6/7] COPY .. /go/src/
#21 DONE 2.5s

#22 [calendar-app build 8/9] COPY .. /go/src/
#22 DONE 2.6s

#23 [calendar-app build 9/9] RUN CGO_ENABLED=0 go build         -ldflags "$LDFLAGS"         -o /opt/calendar/calendar-app cmd/calendar/*
#23 ...

#24 [calendar-sender build 7/7] RUN CGO_ENABLED=0 go build         -ldflags "$LDFLAGS"         -o /opt/calendar/calendar-sender cmd/calendar_sender/*
#24 ...

#23 [calendar-app build 9/9] RUN CGO_ENABLED=0 go build         -ldflags "$LDFLAGS"         -o /opt/calendar/calendar-app cmd/calendar/*
#23 DONE 18.1s

#24 [calendar-sender build 7/7] RUN CGO_ENABLED=0 go build         -ldflags "$LDFLAGS"         -o /opt/calendar/calendar-sender cmd/calendar_sender/*
#24 DONE 18.2s

#25 [calendar-app stage-1 3/4] COPY --from=build /opt/calendar/ /opt/calendar/
#25 CACHED

#26 [calendar-app stage-1 2/4] RUN mkdir -p /opt/calendar/
#26 CACHED

#27 [calendar-app stage-1 4/4] WORKDIR /opt/calendar/
#27 CACHED

#28 [calendar-sender stage-1 2/2] COPY --from=build /opt/calendar/calendar-sender /opt/calendar/calendar-sender
#28 CACHED

#29 [calendar-app] exporting to image
#29 exporting layers done
#29 writing image sha256:86d3c39d0e62c19ed3b3dc14c0c63c1642b77e1ca14f4dd4ca9376046f881127 done
#29 naming to docker.io/library/hw12_13_14_15_calendar-calendar-app 0.0s done
#29 DONE 0.0s

#30 [calendar-sender] exporting to image
#30 exporting layers done
#30 writing image sha256:52864c65954b67055c2ab539019f6e8c825d6f2c1846da8b45846468131e02bb done
#30 naming to docker.io/library/hw12_13_14_15_calendar-calendar-sender
#30 naming to docker.io/library/hw12_13_14_15_calendar-calendar-sender 0.0s done
#30 DONE 0.0s

#31 [calendar-scheduler internal] load .dockerignore
#31 transferring context: 2B done
#31 DONE 0.0s

#32 [calendar-scheduler internal] load build definition from Dockerfile
#32 transferring dockerfile: 886B done
#32 DONE 0.1s

#5 [calendar-scheduler internal] load metadata for docker.io/library/golang:1.22
#5 DONE 3.5s

#6 [calendar-scheduler internal] load metadata for docker.io/library/alpine:3.9
#6 DONE 3.5s

#7 [calendar-scheduler stage-1 1/2] FROM docker.io/library/alpine:3.9@sha256:414e0518bb9228d35e4cd5165567fb91d26c6a214e9c95899e1e056fcd349011
#7 DONE 0.0s

#8 [calendar-scheduler build 1/7] FROM docker.io/library/golang:1.22@sha256:4594271250150c1a322ed749abfd218e1a8c6eb1ade90872e325a664412e2037
#8 DONE 0.0s

#33 [calendar-scheduler internal] load build context
#33 transferring context: 45.39kB 0.0s done
#33 DONE 0.0s

#17 [calendar-scheduler build 2/7] WORKDIR /go/src/
#17 CACHED

#34 [calendar-scheduler build 4/7] COPY go.sum .
#34 CACHED

#35 [calendar-scheduler build 3/7] COPY go.mod .
#35 CACHED

#36 [calendar-scheduler build 5/7] RUN go mod download
#36 CACHED

#37 [calendar-scheduler build 6/7] COPY .. /go/src/
#37 DONE 1.5s

#38 [calendar-scheduler build 7/7] RUN CGO_ENABLED=0 go build         -ldflags "$LDFLAGS"         -o /opt/calendar/calendar-scheduler cmd/calendar_scheduler/*
#38 DONE 10.8s

#39 [calendar-scheduler stage-1 2/2] COPY --from=build /opt/calendar/calendar-scheduler /opt/calendar/calendar-scheduler
#39 CACHED

#40 [calendar-scheduler] exporting to image
#40 exporting layers done
#40 writing image sha256:805849b5aca4ea94de3fc4a8bae50fde38558f4004e6e06fb8162559f9768c98 done
#40 naming to docker.io/library/hw12_13_14_15_calendar-calendar-scheduler done
#40 DONE 0.0s

#41 [integration_tests internal] load build definition from Dockerfile
#41 transferring dockerfile: 203B done
#41 DONE 0.0s

#42 [integration_tests internal] load .dockerignore
#42 transferring context: 2B done
#42 DONE 0.0s

#5 [integration_tests internal] load metadata for docker.io/library/golang:1.22
#5 DONE 4.3s

#8 [integration_tests 1/7] FROM docker.io/library/golang:1.22@sha256:4594271250150c1a322ed749abfd218e1a8c6eb1ade90872e325a664412e2037
#8 DONE 0.0s

#43 [integration_tests internal] load build context
#43 transferring context: 47.12kB 0.0s done
#43 DONE 0.0s

#44 [integration_tests 2/7] RUN mkdir -p /opt/integration_tests
#44 CACHED

#45 [integration_tests 4/7] COPY go.mod .
#45 CACHED

#46 [integration_tests 5/7] COPY go.sum .
#46 CACHED

#47 [integration_tests 3/7] WORKDIR /opt/integration_tests
#47 CACHED

#48 [integration_tests 6/7] RUN go mod download
#48 CACHED

#49 [integration_tests 7/7] COPY . .
#49 DONE 2.0s

#50 [integration_tests] exporting to image
#50 exporting layers 0.9s done
#50 writing image sha256:395a2dfa6de7dfa0be1c30d9f8f4d38175ddb835401ce07a674fbf4b67f3e1dd done
#50 naming to docker.io/library/hw12_13_14_15_calendar-integration_tests done
#50 DONE 0.9s
ok  	github.com/Serega2780/otus-golang-hw/hw12_13_14_15_calendar/integration	3.022s
